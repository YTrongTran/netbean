package View;

/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
import model.QuanlyDiiemPanel;
import java.text.DecimalFormat;
import javafx.scene.control.ComboBox;
import javax.swing.ComboBoxModel;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import model.QuanlyDiemDAO;

/**
 *
 * @author trany
 */
public class QuanLyDiemSinhvienPannel extends javax.swing.JPanel {

    SinhvienDAO svdao = new SinhvienDAO();
    QuanlyDiemDAO dao = new QuanlyDiemDAO();
static int position =0;
    /**
     * Creates new form QuanLyDiemSinhvienPannel
     */
    public QuanLyDiemSinhvienPannel() {
        initComponents();
        getCombosinhvien();
    }

    public void getCombosinhvien() {
        DefaultComboBoxModel<Sinhvien> model = (DefaultComboBoxModel) cbosinhvien.getModel();
        for (Sinhvien sv : svdao.getALlSinhvien()) {
            model.addElement(sv);
        }

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        cbosinhvien = new javax.swing.JComboBox<>();
        txtmasv = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        txttensv = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        txtdiemtinhoc = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        txtdiemanhvan = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        txtgiaoductc = new javax.swing.JTextField();
        btnnew = new javax.swing.JButton();
        btnsave = new javax.swing.JButton();
        btnedit = new javax.swing.JButton();
        btnxoa = new javax.swing.JButton();
        jLabel7 = new javax.swing.JLabel();
        lbldtb = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tabbang = new javax.swing.JTable();
        jButton5 = new javax.swing.JButton();
        jButton6 = new javax.swing.JButton();
        jButton7 = new javax.swing.JButton();
        jButton8 = new javax.swing.JButton();
        btnthoat = new javax.swing.JButton();
        btnadd = new javax.swing.JButton();
        lblstatus = new javax.swing.JLabel();

        jLabel1.setText("Sinh vien:");

        jLabel2.setText("MÃ£ SV:");

        cbosinhvien.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                cbosinhvienFocusGained(evt);
            }
        });
        cbosinhvien.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbosinhvienActionPerformed(evt);
            }
        });

        jLabel3.setText("Ten SV:");

        jLabel4.setText("DIEM TIN HOC: ");

        jLabel5.setText("DIEM ANH VAN");

        jLabel6.setText("GIAO DUC TC:");

        btnnew.setText("NEW");
        btnnew.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnnewActionPerformed(evt);
            }
        });

        btnsave.setText("SAVE");
        btnsave.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnsaveActionPerformed(evt);
            }
        });

        btnedit.setText("EDIT");

        btnxoa.setText("DELTE");
        btnxoa.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnxoaActionPerformed(evt);
            }
        });

        jLabel7.setText("DIEM TRUNG BINH:");

        lbldtb.setFont(new java.awt.Font("Tahoma", 0, 36)); // NOI18N
        lbldtb.setForeground(new java.awt.Color(0, 0, 255));
        lbldtb.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lbldtb.setText("0.0");
        lbldtb.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));

        tabbang.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null}
            },
            new String [] {
                "MA SV", "TEN SV", "TIN HOC", "ANH VAN", "GIAO DUC TC", "TONG DIEM", "XEP LOAI"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.Double.class, java.lang.Double.class, java.lang.String.class, java.lang.Double.class, java.lang.String.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        tabbang.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tabbangMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tabbang);

        jButton5.setText("|<");
        jButton5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton5ActionPerformed(evt);
            }
        });

        jButton6.setText("<<");

        jButton7.setText(">>");

        jButton8.setText(">|");

        btnthoat.setText("EXIT");
        btnthoat.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnthoatActionPerformed(evt);
            }
        });

        btnadd.setText("ADD");
        btnadd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnaddActionPerformed(evt);
            }
        });

        lblstatus.setText("Status:");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                        .addGap(8, 8, 8)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel5, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel6, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel1, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel2, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel3, javax.swing.GroupLayout.Alignment.TRAILING))
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                                .addGap(18, 18, 18)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(txtdiemtinhoc, javax.swing.GroupLayout.PREFERRED_SIZE, 210, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                        .addComponent(txttensv)
                                        .addComponent(cbosinhvien, 0, 210, Short.MAX_VALUE)
                                        .addComponent(txtmasv)))
                                .addGap(18, 18, 18)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(btnnew)
                                    .addComponent(btnsave)
                                    .addComponent(btnedit)
                                    .addComponent(btnadd))
                                .addGap(0, 0, Short.MAX_VALUE))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(18, 18, 18)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(layout.createSequentialGroup()
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                            .addComponent(txtgiaoductc, javax.swing.GroupLayout.DEFAULT_SIZE, 210, Short.MAX_VALUE)
                                            .addComponent(txtdiemanhvan))
                                        .addGap(18, 18, 18)
                                        .addComponent(btnxoa))
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(jButton5)
                                        .addGap(18, 18, 18)
                                        .addComponent(jButton6)
                                        .addGap(18, 18, 18)
                                        .addComponent(jButton7)
                                        .addGap(18, 18, 18)
                                        .addComponent(jButton8)))
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(layout.createSequentialGroup()
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 94, Short.MAX_VALUE)
                                        .addComponent(jLabel7)
                                        .addGap(61, 61, 61))
                                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 41, Short.MAX_VALUE)
                                        .addComponent(lbldtb, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addGap(0, 27, Short.MAX_VALUE))))))
                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jScrollPane1))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(19, 19, 19)
                        .addComponent(lblstatus)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(btnthoat)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(80, 80, 80)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(6, 6, 6)
                        .addComponent(jLabel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(cbosinhvien)
                        .addComponent(btnadd, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(9, 9, 9)
                        .addComponent(jLabel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(3, 3, 3)
                        .addComponent(txtmasv))
                    .addComponent(btnnew))
                .addGap(28, 28, 28)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(9, 9, 9)
                        .addComponent(jLabel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(3, 3, 3)
                        .addComponent(txttensv))
                    .addComponent(btnsave))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel4, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGap(9, 9, 9))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(txtdiemtinhoc)
                        .addGap(3, 3, 3))
                    .addComponent(btnedit, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(3, 3, 3)
                        .addComponent(txtdiemanhvan))
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jLabel5, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(btnxoa, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel7, javax.swing.GroupLayout.PREFERRED_SIZE, 27, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(7, 7, 7)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(6, 6, 6)
                                .addComponent(jLabel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                            .addComponent(txtgiaoductc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(lbldtb, javax.swing.GroupLayout.PREFERRED_SIZE, 87, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jButton5)
                    .addComponent(jButton6)
                    .addComponent(jButton7)
                    .addComponent(jButton8))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(145, 145, 145)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnthoat)
                    .addComponent(lblstatus))
                .addGap(4, 4, 4))
        );
    }// </editor-fold>//GEN-END:initComponents
public QuanlyDiiemPanel getModel() {
        QuanlyDiiemPanel ql = new QuanlyDiiemPanel();
        ql.setDiemAV(Double.parseDouble(txtdiemanhvan.getText()));
        ql.setDiemTin(Double.parseDouble(txtdiemtinhoc.getText()));
        ql.setDiemGDTC(Double.parseDouble(txtgiaoductc.getText()));
        ql.setSv(new Sinhvien(txtmasv.getText(), txttensv.getText()));

        return ql;

    }
    private void cbosinhvienActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbosinhvienActionPerformed
        // TODO add your handling code here:


    }//GEN-LAST:event_cbosinhvienActionPerformed


    private void cbosinhvienFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_cbosinhvienFocusGained
        // TODO add your handling code here:
        getCombosinhvien();

    }//GEN-LAST:event_cbosinhvienFocusGained
    
    private void btnaddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnaddActionPerformed
        // TODO add your handling code here:
        Sinhvien sv = (Sinhvien) cbosinhvien.getSelectedItem();
        System.out.println("=>" + sv.toString());
        txtmasv.setText(sv.getMaSV());
        txttensv.setText(sv.getTenSV());


    }//GEN-LAST:event_btnaddActionPerformed
    public void getModel(QuanlyDiiemPanel ql) {
        txtmasv.setText(txtmasv.getText());
        txttensv.setText(txttensv.getText());
        txtdiemanhvan.setText(ql.getDiemAV() + "");
        txtdiemtinhoc.setText(ql.getDiemTin() + "");
        txtgiaoductc.setText(ql.getDiemGDTC() + "");
        lbldtb.setText(ql.getDiemTb() + "");

    }
    private void btnsaveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnsaveActionPerformed
        // TODO add your handling code here:
        QuanlyDiiemPanel ql = getModel();

        if (dao.add(ql) > 0) {
            JOptionPane.showMessageDialog(this, "Luu thanh cong");
            fillData();
            resert();
        }


    }//GEN-LAST:event_btnsaveActionPerformed
public void resert() {
        txtmasv.setText("");
        txttensv.setText("");
        txtgiaoductc.setText("");
        txtdiemtinhoc.setText("");
        txtdiemanhvan.setText("");      

    }
    private void btnnewActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnnewActionPerformed
        // TODO add your handling code here:
        resert();
    }//GEN-LAST:event_btnnewActionPerformed

    private void btnthoatActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnthoatActionPerformed
        // TODO add your handling code here:
        System.exit(0);
    }//GEN-LAST:event_btnthoatActionPerformed

    private void btnxoaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnxoaActionPerformed
        // TODO add your handling code here:
        String find = txtmasv.getText();
        if (dao.del(find) > 0) {
            JOptionPane.showMessageDialog(this, "xoa thanh cong");

            fillData();
            resert();

       }
//        String find =txtmasv.getText();
//        int a =dao.findByID(find);
//         dao.dell(a);
//        JOptionPane.showMessageDialog(this, "xoa thanh cong");
//        fillData();
    }//GEN-LAST:event_btnxoaActionPerformed

    private void tabbangMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tabbangMouseClicked
        // TODO add your handling code here:
        int rowId = tabbang.rowAtPoint(evt.getPoint());
        QuanlyDiiemPanel ql = dao.getAtDiem(rowId);
//        setModel(ql);
    }//GEN-LAST:event_tabbangMouseClicked

    private void jButton5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton5ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jButton5ActionPerformed
    public void fillData() {
        DefaultTableModel model = (DefaultTableModel) tabbang.getModel();
        model.setRowCount(0);
        for (QuanlyDiiemPanel ql : dao.getDiiemPanels()) {
            Object[] rowData = new Object[7];
            rowData[0] = ql.getSv().getMaSV();
            rowData[1] = ql.getSv().getTenSV();
            rowData[2] = ql.getDiemTin();
            rowData[3] = ql.getDiemAV();
            rowData[4] = ql.getDiemGDTC();
            rowData[5] = ql.getDiemTb();
            rowData[6] = ql.xeploai();
            model.addRow(rowData);
            double b = (double) (ql.getDiemAV() + ql.getDiemTin() + ql.getDiemGDTC()) / 3;
            DecimalFormat de = new DecimalFormat("#.##");
            lbldtb.setText(Double.toString(b));
            System.out.println(de.format(b));

        }

    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnadd;
    private javax.swing.JButton btnedit;
    private javax.swing.JButton btnnew;
    private javax.swing.JButton btnsave;
    private javax.swing.JButton btnthoat;
    private javax.swing.JButton btnxoa;
    private javax.swing.JComboBox<String> cbosinhvien;
    private javax.swing.JButton jButton5;
    private javax.swing.JButton jButton6;
    private javax.swing.JButton jButton7;
    private javax.swing.JButton jButton8;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lbldtb;
    private javax.swing.JLabel lblstatus;
    private javax.swing.JTable tabbang;
    private javax.swing.JTextField txtdiemanhvan;
    private javax.swing.JTextField txtdiemtinhoc;
    private javax.swing.JTextField txtgiaoductc;
    private javax.swing.JTextField txtmasv;
    private javax.swing.JTextField txttensv;
    // End of variables declaration//GEN-END:variables

    private void setModel(QuanlyDiiemPanel ql) {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }
}
